
(function(b){b(function(){function s(b){var d,a,e=[1,1];for(a=0;2>a;a++)for(d=0;d<calcCfg.specialistCounts[a].length&&!(-1!=b[a]&&calcCfg.specialistCounts[a][d]>b[a]);d+=2)e[a]=calcCfg.specialistCounts[a][d+1];if (b[0]>0 && b[1] == 0) {e[0]+=1} return e[0] + e[1]}function k(c,d,a){if("string"==typeof c){for(var e,h=/{(\w+)}/g,n=c;null!==(e=h.exec(c));)n=n.replace(e[0],k(calcCfg.priceList[e[1]][a],d,a));c=eval(n.replace(",","."))}if(b.isArray(c)){var g=[0,0],f;for(a=0;a<c.length;a+=2){if(c[a]==d){f=c[a+1];break}else if(c[a]>d){f=g[1]-
(d-g[0])*(g[1]-c[a+1])/(c[a]-g[0]);break}g=[c[a],c[a+1]]}}else f=c;return Math.ceil(null===f?g[1]:f)}function f(b){return b.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function l(){var c=[t.val(),u.val()],d=b("input[name=tariff]:checked").val(),d=calcCfg.priceList[d],a,e=[0,0];for(a=0;2>a;a++)e[a]=c[a]*k(d[a],c[a],a);d=e[0]+e[1];p[0].html(f(d));p[1].html(f(e[0]));p[2].html(f(e[1]));b(".service .part").each(function(a){var c=q+e[a]*r;m[0][a]!=c&&(m[0][a]=c,b(this).stop().animate({height:c},300).css("overflow",
    "visible"))});var h=s(c);a=(calcCfg.specialistPay[0]+calcCfg.specialistPay[1]+calcCfg.specialistPay[2])*h;v[0].html(f(a));b.each(calcCfg.specialistPay,function(a,b){v[a+1].html(f(b*h))});c=b(".profit");d=a-d;b(".price",c).html(f(d));0>=d?c.addClass("no"):c.removeClass("no");b(".specialist .part").each(function(a){var c=q+calcCfg.specialistPay[a]*r*h;m[1][a]!=c&&(m[1][a]=c,b(this).stop().animate({height:c},300).css("overflow","visible"))})}var p=[b(".service .fullprice"),b(".service .server .price"),
        b(".service .desktop .price")],v=[b(".specialist .fullprice"),b(".specialist .due .price"),b(".specialist .desk .price"),b(".specialist .salary .price")],u=b("#desktop-count").val(calcCfg.desktopParam.val),t=b("#server-count").val(calcCfg.serverParam.val),w={desktop:b(".param .desktop").slider(calcCfg.desktopParam).on("move",function(){u.val(b(this).data("val"));l()}),server:b(".param .server").slider(calcCfg.serverParam).on("move",function(){t.val(b(this).data("val"));l()})},q=10,m=[[0,0],[0,0,0]],
    r;b(".column").each(function(){var c=15;b(".part",this).each(function(){b(this).css("zIndex",c--)})});b(".slider input").on("change keyup input click",function(){this.value.match(/[^0-9]/g)&&(this.value=this.value.replace(/[^0-9]/g,""))}).blur(function(){w[this.name].slider("set",0,this.value)});b("input[name=tariff]").change(l);b(".service li").attr({"data-hintpos":"right","data-hint":"self"});b(".specialist li").attr({"data-hintpos":"left","data-hint":"self"});setTimeout(function(){var c=b(".stack").eq(1),
    d=(calcCfg.specialistPay[0]+calcCfg.specialistPay[1]+calcCfg.specialistPay[2])*s([-1,-1]),a=0;b.each(calcCfg.priceList,function(b,c){a=Math.max(a,calcCfg.serverParam.max*k(c[0],calcCfg.serverParam.max,0)+calcCfg.desktopParam.max*k(c[1],calcCfg.desktopParam.max,1))});r=(c.innerHeight()-b("h3",c).outerHeight(!0)-15-3*q)/Math.max(a,d);l()},10)})})(jQuery);
